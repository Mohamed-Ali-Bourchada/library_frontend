<div class="container mt-4">
    <!-- Barre de filtres -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Section des filtres -->
        <div>
          <button class="btn btn-outline-primary me-2">All</button>
          <button class="btn btn-outline-success me-2">Disponible</button>
          <button class="btn btn-outline-danger">Non Disponibles</button>
        </div>
      
        <!-- Section de recherche alignée à droite -->
        <div class="d-flex align-items-center">
          <input 
            type="text" 
            class="form-control w-50 me-2" 
            placeholder="Rechercher un livre..."
              >
              <!-- [(ngModel)]="searchTerm" -->
              <!-- Liens bidirectionnels pour la recherche -->
          
          <button 
            class="btn btn-outline-secondary"
            >Rechercher</button>
            <!-- (click)="searchBooks()" -->
        </div>
      </div>
      
  
    <!-- Tableau des livres -->
    <table class="table table-striped">
        <thead>
          <tr>
            <th>cover</th>
            <th>Titre</th>
            <th>Auteur</th>
            <th>Disponibilité</th>
            <th>Category</th>
            <th>Sujet</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let book of books">
            <td>
              <div class="image-container">
                <!-- Image avec agrandissement au survol -->
                <img 
                  [src]="book.cover ? 'data:image/jpeg;base64,' + book.cover : 'images/bookCover.jpg'" 
                  alt="{{ book.title }}" 
                  class="category-image" 
                  style="height: 50px; width: 70px;" 
                  (click)="openCoverModal(book)">
              </div>
            </td>
            <td>{{ book.title }}</td>
            <td>{{ book.author }}</td>


            <td>
              <!-- Badge avec logique de clic -->
              <span 
                [class]="book.stateBook == 'disponible' ? 'badge bg-success' : 'badge bg-danger'" 
                (click)="openUnavailableModal(book)"
                [ngClass]="{'clickable': book.stateBook == 'indisponible'}"
                [attr.data-bs-toggle]="book.stateBook == 'indisponible' ? 'modal' : null"
                [attr.data-bs-target]="book.stateBook == 'indisponible' ? '#unavailableModal' : null">
                {{ book.stateBook || 'Available' }}
              </span>
            </td>


            <td>{{ book.category }}</td>
            <td class="sujet">{{ book.sujet }}</td>
            <td>
              <div class="btn btn-warning m-1" (click)="openModal(book)" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Modifier
              </div>
              <div class="btn btn-danger m-1" (click)="deletBook(book.id)">
                Supprimer
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      
<!-- Modal Update Book-->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #007bff; color: white;">
          <h5 class="modal-title" id="exampleModalLabel">Modifier les informations du livre</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col">
              <form>
                <!-- Titre -->
                <div class="mb-3">
                  <label for="bookTitle" class="form-label">Titre</label>
                  <input type="text" id="bookTitle" [(ngModel)]="selectedBook.title" name="title" class="form-control" placeholder="Entrez le titre du livre">
                </div>
  
                <!-- Auteur -->
                <div class="mb-3">
                  <label for="bookAuthor" class="form-label">Auteur</label>
                  <input type="text" id="bookAuthor" [(ngModel)]="selectedBook.author" name="author" class="form-control" placeholder="Entrez l'auteur du livre">
                </div>
  
                <!-- Catégorie -->

                <div class="mb-3">
                  <label for="bookCategory" class="form-label">Catégorie</label>
                  <select id="bookCategory" [(ngModel)]="selectedBook.category" name="category" class="form-control">
                    <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                  </select>
                </div>
                <!-- sujet -->
                <div class="mb-3">
                  <label for="bookSujet" class="form-label">Sujet</label>
                  <textarea id="bookSujet" [(ngModel)]="selectedBook.sujet" name="sujet" class="form-control" rows="3" placeholder="Entrez le sujet du livre"></textarea>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
          <button 
          type="button" 
          class="btn btn-primary" 
          (click)="saveChanges()" 
          data-bs-dismiss="modal">
          Enregistrer les modifications
        </button>        </div>
      </div>
    </div>
  </div>
  
<!-- Modal Update Cover -->
<div class="modal fade" id="coverModal" tabindex="-1" aria-labelledby="coverModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="coverModalLabel">Changer la couverture</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="file" (change)="onCoverFileSelected($event)" accept="image/*" class="form-control" />
        <img 
          *ngIf="selectedBook.cover" 
          [src]="'data:image/jpeg;base64,' + selectedBook.cover" 
          alt="Aperçu de la couverture" 
          class="img-fluid mt-3" 
          style="max-height: 300px;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="button" class="btn btn-primary" (click)="updateCover(selectedBook.cover)">Enregistrer</button>
      </div>
    </div>
  </div>
</div>



<!-- Modal pour état indisponible -->
<div class="modal fade" id="unavailableModal" tabindex="-1" aria-labelledby="unavailableModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg rounded">
      <!-- En-tête du modal -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title d-flex align-items-center" id="unavailableModalLabel">
          <i class="bi bi-book me-2"></i>{{ unavailableBook?.book?.title }}
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Corps du modal -->
      <div class="modal-body">
        <div class="d-flex flex-column align-items-start">
          <p class="mb-2">
            <i class="bi bi-person-circle text-primary me-2"></i>
            <strong>Nom et Prénom :</strong> {{ unavailableBook?.user?.fullName }}
          </p>
          <p class="mb-2">
            <i class="bi bi-envelope text-primary me-2"></i>
            <strong>Email :</strong> {{ unavailableBook?.user?.email }}
          </p>
          <p class="mb-2">
            <i class="bi bi-telephone text-primary me-2"></i>
            <strong>Téléphone :</strong> {{ unavailableBook?.user?.telephone }}
          </p>
          <p class="mb-2">
            <i class="bi bi-calendar text-primary me-2"></i>
            <strong>Date d'emprunt :</strong> {{ unavailableBook?.dateEmprunt | date:'shortDate' }}
          </p>
          <p 
            class="mb-2"
            [ngClass]="{
              'text-success': isDateRetourBeforeNow(unavailableBook?.dateRoutourPrevu),
              'text-danger': !isDateRetourBeforeNow(unavailableBook?.dateRoutourPrevu)
            }">
            <i class="bi bi-calendar-check text-primary me-2"></i>
            <strong>Date de retour :</strong> {{ unavailableBook?.dateRoutourPrevu | date:'shortDate' }}
          </p>
      
          <!-- Bouton pour définir le retour si la date est passée -->
          <button 
            class="btn btn-warning mt-2" 
            (click)="setRetourBook(unavailableBook?.id)"
            data-bs-dismiss="modal">
            <i class="bi bi-arrow-repeat me-1"
            ></i> Marquer comme retourné
          </button>
        </div>
      </div>
      
      <!-- Pied de page du modal -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle"></i> Fermer
        </button>
      </div>
    </div>
  </div>
</div>
